<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>오늘의 운세 & 행운 음료</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif;background:#fff8e8;margin:0;color:#222}
  .wrap{max-width:520px;margin:0 auto;padding:24px}
  .card{background:#fff;border-radius:16px;box-shadow:0 6px 20px rgba(0,0,0,.08);padding:20px;margin:16px 0}
  h1{font-size:22px;margin:0 0 6px}
  h2{font-size:18px;margin:0 0 12px}
  .bar{height:10px;background:#ffe2bf;border-radius:999px;overflow:hidden}
  .fill{height:100%;background:#ff8a3d}
  .row{display:flex;justify-content:space-between;align-items:center;margin:10px 0}
  .pill{display:inline-block;background:#222;color:#fff;border-radius:999px;padding:6px 10px;font-size:12px}
  .badge{display:inline-block;background:#ffeede;color:#ad4b00;padding:4px 8px;border-radius:8px;margin-left:8px;font-size:12px}
  .muted{color:#666;font-size:12px}
  .drink{display:flex;gap:12px;align-items:center}
  .drink img{width:64px;height:64px;border-radius:10px;object-fit:cover;background:#f2f2f2}
  .big{font-size:28px;font-weight:700}
  .foot{font-size:12px;color:#666;text-align:center;margin-top:12px}
  .code{font-family:ui-monospace, SFMono-Regular, Menlo, monospace;letter-spacing:1px}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>고객님의 오늘의 운세</h1>
    <div id="fortuneText" style="line-height:1.5;margin-top:8px;"></div>
    <div class="row" style="margin-top:12px;">
      <div class="pill">유효기간 <span id="validUntil" class="badge"></span></div>
      <div class="pill">확인코드 <span id="dailyCode" class="badge code"></span></div>
    </div>
    <div class="muted" style="margin-top:6px;">* 화면 캡처 지참 시 <b>3일 이내</b> 사용 가능 (유효일자·코드 확인)</div>
  </div>

  <div class="card">
    <h2>점수</h2>
    <div id="scores"></div>
  </div>

  <div class="card">
    <h2>행운 키워드</h2>
    <div class="row"><div>숫자</div><div id="kwNumber" class="pill"></div></div>
    <div class="row"><div>방향</div><div id="kwDir" class="pill"></div></div>
    <div class="row"><div>컬러</div><div id="kwColor" class="pill"></div></div>
    <div class="row"><div>음식</div><div id="kwFood" class="pill"></div></div>
  </div>

  <div class="card">
    <h2>오늘의 행운 음료</h2>
    <div class="drink">
      <img id="drinkImg" alt="drink"/>
      <div>
        <div id="drinkName" class="big"></div>
        <div id="drinkNote" class="muted"></div>
      </div>
    </div>
  </div>

  <div class="foot">
    페이지 생성 기준 (KST): <span id="nowKST"></span>
    <br/>지점/캠페인: <span id="shopId" class="code"></span>
  </div>
</div>

<script>
(function(){
  // --- 유틸: KST 현재 날짜/시간 ---
  const nowUTC = new Date();
  const nowKST = new Date(nowUTC.getTime() + (9 * 60 * 60 * 1000));
  const yyyy = nowKST.getUTCFullYear();
  const mm = String(nowKST.getUTCMonth()+1).padStart(2,'0');
  const dd = String(nowKST.getUTCDate()).padStart(2,'0');
  const todayStr = `${yyyy}-${mm}-${dd}`; // 매일 0시 기준 seed

  // --- URL 파라미터: ?id=지점코드 (없으면 'default') ---
  const params = new URLSearchParams(location.search);
  const shop = (params.get('id') || 'default').toLowerCase();

  // --- 데이터 (원하시면 자유롭게 수정) ---
  const fortunes = [
    "오늘은 사랑이 반짝이는 하루예요. 마음이 닿는 사람과의 순간이 특별해질 거예요.",
    "작은 행운이 큰 행복으로 이어집니다. 기회가 보이면 가볍게 잡아보세요.",
    "집중력이 높아지는 날! 미뤄둔 일을 시작하면 술술 풀릴 거예요.",
    "주변의 배려가 빛나는 날. 감사 인사를 전하면 더 큰 선물이 돌아옵니다.",
    "새로운 아이디어가 번쩍! 메모해두면 며칠 내 좋은 결과가 나옵니다."
  ];
  const directions = ["동쪽","서쪽","남쪽","북쪽","동남쪽","서남쪽","동북쪽","서북쪽"];
  const colors = ["말차 포레스트","로즈 핑크","피치 오렌지","바닐라 크림","하늘 민트","초코 브라운"];
  const foods  = ["소갈비","파스타","마카롱","연어샐러드","김치볶음밥","크루아상"];
  const drinks = [
    {name:"디카페인 핑크카페라떼", img:"https://picsum.photos/seed/pink/200", note:"부담 없이 달콤하게"},
    {name:"말차 크림라떼", img:"https://picsum.photos/seed/matcha/200", note:"부드럽고 진하게"},
    {name:"자몽에이드", img:"https://picsum.photos/seed/grapefruit/200", note:"상큼하게 리프레시"},
    {name:"헤이즐넛 라떼", img:"https://picsum.photos/seed/hazel/200", note:"고소한 데일리"},
    {name:"바닐라 콜드브루", img:"https://picsum.photos/seed/vanilla/200", note:"깔끔한 여운"},
    {name:"초코 브라우니 프라페", img:"https://picsum.photos/seed/choco/200", note:"진한 당충전"}
  ];

  // --- 해시 & 난수 (지점코드 + 날짜 기반 ⇒ 모두에게 같은 결과) ---
  function strHash(s){
    let h=2166136261>>>0;
    for(let i=0;i<s.length;i++){ h^=s.charCodeAt(i); h=(h*16777619)>>>0; }
    return h>>>0;
  }
  function mulberry32(a){ return function(){ a|=0; a=a+0x6D2B79F5|0; let t=Math.imul(a^a>>>15,1|a); t=t+Math.imul(t^t>>>7,61|t)^t; return ((t^t>>>14)>>>0)/4294967296; } }
  const seed = strHash(`${shop}|${todayStr}`);
  const rand = mulberry32(seed);
  const pick = arr => arr[Math.floor(rand()*arr.length)];
  const randInt = (min,max)=> Math.floor(rand()*(max-min+1))+min;

  // --- 결과 생성 ---
  const fortune = pick(fortunes);
  const scores = [
    {label:"금전", val: randInt(70,98)},
    {label:"직장", val: randInt(60,95)},
    {label:"애정", val: randInt(65,100)},
    {label:"학업", val: randInt(60,95)},
    {label:"건강", val: randInt(70,99)},
  ];
  const kw = {
    number: randInt(1,9),
    dir: pick(directions),
    color: pick(colors),
    food: pick(foods)
  };
  const drink = pick(drinks);

  // --- 3일 유효일 계산 ---
  const valid = new Date(Date.UTC(yyyy, Number(mm)-1, Number(dd))); // KST 자정 기준
  valid.setUTCDate(valid.getUTCDate()+3);
  const vyyyy=valid.getUTCFullYear(), vmm=String(valid.getUTCMonth()+1).padStart(2,'0'), vdd=String(valid.getUTCDate()).padStart(2,'0');
  const validStr = `${vyyyy}-${vmm}-${vdd}`;

  // --- 일일 확인코드(6자리) : 날짜+지점 기반 ---
  const dailyCode = String((seed % 1000000 + 1000000) % 1000000).padStart(6,'0');

  // --- 렌더 ---
  document.getElementById('fortuneText').textContent = fortune;
  document.getElementById('validUntil').textContent = `${validStr} 23:59`;
  document.getElementById('dailyCode').textContent = dailyCode;
  document.getElementById('kwNumber').textContent = kw.number;
  document.getElementById('kwDir').textContent = kw.dir;
  document.getElementById('kwColor').textContent = kw.color;
  document.getElementById('kwFood').textContent = kw.food;
  document.getElementById('drinkName').textContent = drink.name;
  document.getElementById('drinkImg').src = drink.img;
  document.getElementById('drinkNote').textContent = drink.note;
  document.getElementById('shopId').textContent = shop;
  document.getElementById('nowKST').textContent =
    `${todayStr} ${String(nowKST.getUTCHours()).padStart(2,'0')}:${String(nowKST.getUTCMinutes()).padStart(2,'0')}:${String(nowKST.getUTCSeconds()).padStart(2,'0')} (KST)`;

  // --- 점수 바 출력 ---
  const holder = document.getElementById('scores');
  scores.forEach(s=>{
    const row = document.createElement('div'); row.className='row';
    row.innerHTML = `<div>${s.label}</div><div>${s.val}점</div>`;
    const bar = document.createElement('div'); bar.className='bar';
    const fill = document.createElement('div'); fill.className='fill'; fill.style.width=`${s.val}%`;
    bar.appendChild(fill);
    holder.appendChild(row); holder.appendChild(bar);
  });
})();
</script>
</body>
</html>
